{% extends "base_generic.html" %}

{% block style %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock %}

{% block content %}
<div class="content-section">
    <h1 class="section-title">Edit Availability for {{ worker }}</h1>

    <form method="post" class="form-section">
        {% csrf_token %}

        <div class="form-group">
            <label for="unavailablePicker">Select unavailable dates:</label>
            <input id="unavailablePicker" class="form-control" placeholder="Pick unavailable dates" />
            {{ form.unavailable_dates_json }}
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">Save</button>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    const initial = {{ initial_dates_json|safe }};
    const fp = flatpickr("#unavailablePicker", {
        mode: "multiple",
        dateFormat: "Y-m-d",
        defaultDate: initial
    });

    const hidden = document.querySelector('input[name="unavailable_dates_json"]');

    function syncHidden() {
        const arr = fp.selectedDates.map(d => fp.formatDate(d, "Y-m-d"));
        hidden.value = JSON.stringify(arr);
    }

    fp.config.onChange.push(syncHidden);
    syncHidden();
    document.querySelector('form').addEventListener('submit', syncHidden);
</script>
{% endblock %}
